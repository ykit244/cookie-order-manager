<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#ec4899">
  <meta name="description" content="å¦ˆå¦ˆçš„æ‰‹å·¥é¥¼å¹²è®¢å•ç®¡ç†å°åŠ©æ‰‹">
  
  <link rel="manifest" href="/manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="é¥¼å¹²è®¢å•">
  <link rel="apple-touch-icon" href="/icon-192.png">
  
  <title>é¥¼å¹²è®¢å•ç®¡ç†</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      overscroll-behavior-y: contain;
    }
    ::-webkit-scrollbar { width: 0px; background: transparent; }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    .calendar-day {
      aspect-ratio: 1;
      min-height: 60px;
    }
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, query, onSnapshot, enableIndexedDbPersistence } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // ğŸ”¥ è¯·æ›¿æ¢ä¸ºä½ çš„ Firebase é…ç½®
    const firebaseConfig = {
      apiKey: "AIzaSyD5JPfaWYueNRS-KCbYsZrGech3ZzLOhfY",
      authDomain: "cookie-order-management.firebaseapp.com",
      projectId: "cookie-order-management",
      storageBucket: "cookie-order-management.firebasestorage.app",
      messagingSenderId: "1007966950255",
      appId: "1:1007966950255:web:dbd1670df9099ef687ce9a",
      measurementId: "G-7NF697073Z"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    enableIndexedDbPersistence(db).catch((err) => {
      console.log('ç¦»çº¿æŒä¹…åŒ–:', err.code);
    });

    window.firebase = {
      app, auth, db,
      GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged,
      collection, doc, setDoc, getDoc, getDocs, deleteDoc, query, onSnapshot
    };

    window.dispatchEvent(new Event('firebaseReady'));
  </script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // å›¾æ ‡ç»„ä»¶
    const Icon = ({ children, size = 20, className = "" }) => (
      <span style={{ display: 'inline-block', width: size, height: size, lineHeight: `${size}px` }} className={className}>
        {children}
      </span>
    );
    
    const Calendar = (p) => <Icon {...p}>ğŸ“…</Icon>;
    const Package = (p) => <Icon {...p}>ğŸ“¦</Icon>;
    const Users = (p) => <Icon {...p}>ğŸ‘¥</Icon>;
    const Plus = (p) => <Icon {...p}>â•</Icon>;
    const Search = (p) => <Icon {...p}>ğŸ”</Icon>;
    const X = (p) => <Icon {...p}>âœ–ï¸</Icon>;
    const Edit2 = (p) => <Icon {...p}>âœï¸</Icon>;
    const Trash2 = (p) => <Icon {...p}>ğŸ—‘ï¸</Icon>;
    const Check = (p) => <Icon {...p}>âœ“</Icon>;
    const Settings = (p) => <Icon {...p}>âš™ï¸</Icon>;
    const ChevronLeft = (p) => <Icon {...p}>â—€</Icon>;
    const ChevronRight = (p) => <Icon {...p}>â–¶</Icon>;
    const Filter = (p) => <Icon {...p}>ğŸ”½</Icon>;
    const LogOut = (p) => <Icon {...p}>ğŸšª</Icon>;

    // Firebase å°±ç»ª Hook
    const useFirebaseReady = () => {
      const [ready, setReady] = useState(false);
      useEffect(() => {
        if (window.firebase) {
          setReady(true);
        } else {
          const handler = () => setReady(true);
          window.addEventListener('firebaseReady', handler);
          return () => window.removeEventListener('firebaseReady', handler);
        }
      }, []);
      return ready;
    };

    // è®¤è¯ Hook
    const useAuth = () => {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const ready = useFirebaseReady();

      useEffect(() => {
        if (!ready) return;
        const { auth, onAuthStateChanged } = window.firebase;
        const unsubscribe = onAuthStateChanged(auth, (user) => {
          setUser(user);
          setLoading(false);
        });
        return unsubscribe;
      }, [ready]);

      const signIn = async () => {
        const { auth, GoogleAuthProvider, signInWithPopup } = window.firebase;
        try {
          await signInWithPopup(auth, new GoogleAuthProvider());
        } catch (error) {
          alert('ç™»å½•å¤±è´¥: ' + error.message);
        }
      };

      const signOutUser = async () => {
        const { auth, signOut } = window.firebase;
        await signOut(auth);
      };

      return { user, loading, signIn, signOut: signOutUser, ready };
    };

    // Firestore æ•°æ® Hook
    const useFirestoreData = (user) => {
      const [orders, setOrders] = useState([]);
      const [customers, setCustomers] = useState([]);
      const [products, setProducts] = useState([]);
      const [yearlyData, setYearlyData] = useState({});
      const [settings, setSettings] = useState({ yearlyTarget: 0 });
      const [currentYear, setCurrentYear] = useState(null);

      const { db, collection, doc, setDoc, getDoc, onSnapshot } = window.firebase || {};

      // åˆå§‹åŒ–å¹´ä»½
      useEffect(() => {
        if (!user || !db) return;

        const initYear = async () => {
          try {
            const yearlyDataRef = doc(db, 'users', user.uid, 'data', 'yearlyData');
            const yearlyDataDoc = await getDoc(yearlyDataRef);
            
            let data = {};
            if (yearlyDataDoc.exists()) {
              data = yearlyDataDoc.data();
            } else {
              const newYear = new Date().getFullYear();
              data = { [newYear]: { settled: false } };
              await setDoc(yearlyDataRef, data);
            }
            
            setYearlyData(data);
            const years = Object.keys(data).sort((a, b) => b - a);
            const currentYearNum = new Date().getFullYear();
            
            if (data[currentYearNum]) {
              setCurrentYear(currentYearNum);
            } else if (years.length > 0) {
              setCurrentYear(parseInt(years[0]));
            }
          } catch (error) {
            console.error('åˆå§‹åŒ–å¹´ä»½å¤±è´¥:', error);
          }
        };

        initYear();
      }, [user, db]);

      // åŠ è½½è®¾ç½®
      useEffect(() => {
        if (!user || !db) return;

        const loadSettings = async () => {
          try {
            const settingsRef = doc(db, 'users', user.uid, 'data', 'settings');
            const settingsDoc = await getDoc(settingsRef);
            if (settingsDoc.exists()) {
              setSettings(settingsDoc.data());
            }
          } catch (error) {
            console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
          }
        };

        loadSettings();
      }, [user, db]);

      // ç›‘å¬è®¢å•
      useEffect(() => {
        if (!user || !db || !currentYear) return;

        const ordersRef = collection(db, 'users', user.uid, 'orders', String(currentYear), 'items');
        const unsubscribe = onSnapshot(ordersRef, (snapshot) => {
          const data = [];
          snapshot.forEach((doc) => {
            data.push({ id: doc.id, ...doc.data() });
          });
          setOrders(data);
        });

        return unsubscribe;
      }, [user, db, currentYear]);

      // ç›‘å¬å®¢æˆ·
      useEffect(() => {
        if (!user || !db) return;

        const customersRef = collection(db, 'users', user.uid, 'customers');
        const unsubscribe = onSnapshot(customersRef, (snapshot) => {
          const data = [];
          snapshot.forEach((doc) => {
            data.push({ id: doc.id, ...doc.data() });
          });
          setCustomers(data);
        });

        return unsubscribe;
      }, [user, db]);

      // ç›‘å¬äº§å“
      useEffect(() => {
        if (!user || !db) return;

        const productsRef = collection(db, 'users', user.uid, 'products');
        const unsubscribe = onSnapshot(productsRef, (snapshot) => {
          const data = [];
          snapshot.forEach((doc) => {
            data.push({ id: doc.id, ...doc.data() });
          });
          setProducts(data);
        });

        return unsubscribe;
      }, [user, db]);

      // ä¿å­˜å‡½æ•°
      const saveOrder = async (order) => {
        if (!user || !currentYear) return;
        const orderId = order.id || `order_${Date.now()}`;
        const orderRef = doc(db, 'users', user.uid, 'orders', String(currentYear), 'items', orderId);
        await setDoc(orderRef, { ...order, id: orderId, updatedAt: new Date().toISOString() });
      };

      const deleteOrder = async (orderId) => {
        if (!user || !currentYear) return;
        const { deleteDoc } = window.firebase;
        const orderRef = doc(db, 'users', user.uid, 'orders', String(currentYear), 'items', orderId);
        await deleteDoc(orderRef);
      };

      const saveCustomer = async (customer) => {
        if (!user) return;
        const customerId = customer.id || `customer_${Date.now()}`;
        const customerRef = doc(db, 'users', user.uid, 'customers', customerId);
        await setDoc(customerRef, { ...customer, id: customerId, updatedAt: new Date().toISOString() });
      };

      const deleteCustomer = async (customerId) => {
        if (!user) return;
        const { deleteDoc } = window.firebase;
        const customerRef = doc(db, 'users', user.uid, 'customers', customerId);
        await deleteDoc(customerRef);
      };

      const saveProduct = async (product) => {
        if (!user) return;
        const productId = product.id || `product_${Date.now()}`;
        const productRef = doc(db, 'users', user.uid, 'products', productId);
        await setDoc(productRef, { ...product, id: productId, updatedAt: new Date().toISOString() });
      };

      const deleteProduct = async (productId) => {
        if (!user) return;
        const { deleteDoc } = window.firebase;
        const productRef = doc(db, 'users', user.uid, 'products', productId);
        await deleteDoc(productRef);
      };

      const saveYearlyData = async (data) => {
        if (!user) return;
        const yearlyDataRef = doc(db, 'users', user.uid, 'data', 'yearlyData');
        await setDoc(yearlyDataRef, data);
      };

      const saveSettings = async (newSettings) => {
        if (!user) return;
        const settingsRef = doc(db, 'users', user.uid, 'data', 'settings');
        await setDoc(settingsRef, newSettings);
        setSettings(newSettings);
      };

      return {
        orders, customers, products, yearlyData, settings, currentYear,
        setCurrentYear, saveOrder, deleteOrder, saveCustomer, deleteCustomer,
        saveProduct, deleteProduct, saveYearlyData, saveSettings, setYearlyData
      };
    };

    // ç™»å½•é¡µé¢
    const LoginPage = ({ onSignIn }) => (
      <div className="login-container">
        <div className="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
          <div className="text-center mb-8">
            <div className="text-6xl mb-4">ğŸª</div>
            <h1 className="text-3xl font-bold text-gray-800 mb-2">é¥¼å¹²è®¢å•ç®¡ç†</h1>
            <p className="text-gray-600">å¦ˆå¦ˆçš„æ‰‹å·¥é¥¼å¹²è®¢å•å°åŠ©æ‰‹</p>
          </div>
          <button
            onClick={onSignIn}
            className="w-full bg-white border-2 border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 flex items-center justify-center gap-3"
          >
            <span>ğŸ”</span>
            ä½¿ç”¨ Google è´¦å·ç™»å½•
          </button>
          <p className="text-xs text-gray-500 text-center mt-6">
            ç™»å½•åï¼Œæ•°æ®å°†å®‰å…¨ä¿å­˜åœ¨äº‘ç«¯<br />æ”¯æŒå¤šè®¾å¤‡åŒæ­¥å’Œç¦»çº¿ä½¿ç”¨
          </p>
        </div>
      </div>
    );

    // ä¸»åº”ç”¨
    const App = () => {
      const { user, loading, signIn, signOut, ready } = useAuth();
      const firebaseData = useFirestoreData(user);

      const [activeTab, setActiveTab] = useState('orders');
      const [showYearSelector, setShowYearSelector] = useState(false);
      const [showOrderForm, setShowOrderForm] = useState(false);
      const [showCustomerForm, setShowCustomerForm] = useState(false);
      const [showProductForm, setShowProductForm] = useState(false);
      const [showFilterPanel, setShowFilterPanel] = useState(false);
      
      const [editingOrder, setEditingOrder] = useState(null);
      const [editingCustomer, setEditingCustomer] = useState(null);
      const [editingProduct, setEditingProduct] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      
      const [calendarDate, setCalendarDate] = useState(new Date());
      const [filterStatus, setFilterStatus] = useState('all');
      const [filterDateType, setFilterDateType] = useState('all');
      const [filterDateRange, setFilterDateRange] = useState({ start: '', end: '' });

      const [orderForm, setOrderForm] = useState({
        customerName: '', customerPhone: '', products: [{ name: '', size: '', quantity: 1, price: 0 }],
        totalAmount: 0, orderDate: new Date().toISOString().split('T')[0],
        deliveryDate: '', status: 'pending', notes: '', deliveryAddress: ''
      });

      const [customerForm, setCustomerForm] = useState({
        name: '', phone: '', address: '', notes: ''
      });

      const [productForm, setProductForm] = useState({
        name: '', sizes: [{ name: '', price: 0 }], unit: 'ç›’', description: ''
      });

      if (!ready || loading) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-pink-50">
            <div className="text-center">
              <div className="text-6xl mb-4 animate-bounce">ğŸª</div>
              <p className="text-gray-600">åŠ è½½ä¸­...</p>
            </div>
          </div>
        );
      }

      if (!user) {
        return <LoginPage onSignIn={signIn} />;
      }

      // è®¢å•æ“ä½œ
      const addOrder = () => {
        setEditingOrder(null);
        setOrderForm({
          customerName: '', customerPhone: '', products: [{ name: '', size: '', quantity: 1, price: 0 }],
          totalAmount: 0, orderDate: new Date().toISOString().split('T')[0],
          deliveryDate: '', status: 'pending', notes: '', deliveryAddress: ''
        });
        setShowOrderForm(true);
      };

      const editOrder = (order) => {
        setEditingOrder(order);
        setOrderForm(order);
        setShowOrderForm(true);
      };

      const saveOrder = async () => {
        if (!orderForm.customerName || !orderForm.customerPhone) {
          alert('è¯·å¡«å†™å®¢æˆ·å§“åå’Œç”µè¯');
          return;
        }
        await firebaseData.saveOrder({
          ...orderForm,
          id: editingOrder?.id,
          createdAt: editingOrder?.createdAt || new Date().toISOString()
        });
        resetOrderForm();
      };

      const removeOrder = async (orderId) => {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
          await firebaseData.deleteOrder(orderId);
        }
      };

      const resetOrderForm = () => {
        setShowOrderForm(false);
        setEditingOrder(null);
        setOrderForm({
          customerName: '', customerPhone: '', products: [{ name: '', size: '', quantity: 1, price: 0 }],
          totalAmount: 0, orderDate: new Date().toISOString().split('T')[0],
          deliveryDate: '', status: 'pending', notes: '', deliveryAddress: ''
        });
      };

      // å®¢æˆ·æ“ä½œ
      const addCustomer = () => {
        setEditingCustomer(null);
        setCustomerForm({ name: '', phone: '', address: '', notes: '' });
        setShowCustomerForm(true);
      };

      const editCustomer = (customer) => {
        setEditingCustomer(customer);
        setCustomerForm(customer);
        setShowCustomerForm(true);
      };

      const saveCustomer = async () => {
        if (!customerForm.name || !customerForm.phone) {
          alert('è¯·å¡«å†™å®¢æˆ·å§“åå’Œç”µè¯');
          return;
        }
        await firebaseData.saveCustomer({
          ...customerForm,
          id: editingCustomer?.id,
          createdAt: editingCustomer?.createdAt || new Date().toISOString()
        });
        resetCustomerForm();
      };

      const removeCustomer = async (customerId) => {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®¢æˆ·å—ï¼Ÿ')) {
          await firebaseData.deleteCustomer(customerId);
        }
      };

      const resetCustomerForm = () => {
        setShowCustomerForm(false);
        setEditingCustomer(null);
        setCustomerForm({ name: '', phone: '', address: '', notes: '' });
      };

      // äº§å“æ“ä½œ
      const addProduct = () => {
        setEditingProduct(null);
        setProductForm({ name: '', sizes: [{ name: '', price: 0 }], unit: 'ç›’', description: '' });
        setShowProductForm(true);
      };

      const editProduct = (product) => {
        setEditingProduct(product);
        setProductForm(product);
        setShowProductForm(true);
      };

      const saveProduct = async () => {
        if (!productForm.name || productForm.sizes.length === 0) {
          alert('è¯·å¡«å†™äº§å“åç§°å’Œè‡³å°‘ä¸€ä¸ªä»·æ ¼');
          return;
        }
        await firebaseData.saveProduct({
          ...productForm,
          id: editingProduct?.id,
          createdAt: editingProduct?.createdAt || new Date().toISOString()
        });
        resetProductForm();
      };

      const removeProduct = async (productId) => {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªäº§å“å—ï¼Ÿ')) {
          await firebaseData.deleteProduct(productId);
        }
      };

      const resetProductForm = () => {
        setShowProductForm(false);
        setEditingProduct(null);
        setProductForm({ name: '', sizes: [{ name: '', price: 0 }], unit: 'ç›’', description: '' });
      };

      // è¾…åŠ©å‡½æ•°
      const addProductSize = () => {
        setProductForm({ ...productForm, sizes: [...productForm.sizes, { name: '', price: 0 }] });
      };

      const removeProductSize = (index) => {
        const newSizes = productForm.sizes.filter((_, i) => i !== index);
        setProductForm({ ...productForm, sizes: newSizes });
      };

      const updateProductSize = (index, field, value) => {
        const newSizes = [...productForm.sizes];
        newSizes[index] = { ...newSizes[index], [field]: value };
        setProductForm({ ...productForm, sizes: newSizes });
      };

      const addOrderProduct = () => {
        setOrderForm({
          ...orderForm,
          products: [...orderForm.products, { name: '', size: '', quantity: 1, price: 0 }]
        });
      };

      const removeOrderProduct = (index) => {
        const newProducts = orderForm.products.filter((_, i) => i !== index);
        setOrderForm({ ...orderForm, products: newProducts });
        calculateTotal(newProducts);
      };

      const updateOrderProduct = (index, field, value) => {
        const newProducts = [...orderForm.products];
        newProducts[index] = { ...newProducts[index], [field]: value };
        setOrderForm({ ...orderForm, products: newProducts });
        calculateTotal(newProducts);
      };

      const calculateTotal = (products) => {
        const total = products.reduce((sum, p) => sum + (p.price * p.quantity), 0);
        setOrderForm(prev => ({ ...prev, totalAmount: total }));
      };

      const selectCustomerForOrder = (customer) => {
        setOrderForm({
          ...orderForm,
          customerName: customer.name,
          customerPhone: customer.phone,
          deliveryAddress: customer.address || ''
        });
      };

      const selectProductForOrder = (product, productIndex) => {
        const newProducts = [...orderForm.products];
        newProducts[productIndex] = {
          ...newProducts[productIndex],
          name: product.name,
          size: product.sizes[0]?.name || '',
          price: product.sizes[0]?.price || 0
        };
        setOrderForm({ ...orderForm, products: newProducts });
        calculateTotal(newProducts);
      };

      const updateProductPrice = (productIndex, sizeName) => {
        const product = firebaseData.products.find(p => p.name === orderForm.products[productIndex].name);
        if (product) {
          const size = product.sizes.find(s => s.name === sizeName);
          if (size) {
            updateOrderProduct(productIndex, 'price', size.price);
          }
        }
      };

      // è¿‡æ»¤è®¢å•
      const filteredOrders = useMemo(() => {
        let filtered = [...firebaseData.orders];

        if (searchTerm) {
          filtered = filtered.filter(order => 
            order.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
            order.customerPhone.includes(searchTerm) ||
            order.id.includes(searchTerm)
          );
        }

        if (filterStatus !== 'all') {
          filtered = filtered.filter(order => order.status === filterStatus);
        }

        const today = new Date().toISOString().split('T')[0];
        if (filterDateType === 'past') {
          filtered = filtered.filter(order => order.deliveryDate && order.deliveryDate < today);
        } else if (filterDateType === 'upcoming') {
          filtered = filtered.filter(order => order.deliveryDate && order.deliveryDate >= today);
        }

        if (filterDateRange.start) {
          filtered = filtered.filter(order => order.deliveryDate && order.deliveryDate >= filterDateRange.start);
        }
        if (filterDateRange.end) {
          filtered = filtered.filter(order => order.deliveryDate && order.deliveryDate <= filterDateRange.end);
        }

        filtered.sort((a, b) => {
          if (!a.deliveryDate) return 1;
          if (!b.deliveryDate) return -1;
          return new Date(a.deliveryDate) - new Date(b.deliveryDate);
        });

        return filtered;
      }, [firebaseData.orders, searchTerm, filterStatus, filterDateType, filterDateRange]);

      // ç»Ÿè®¡
      const statistics = useMemo(() => {
        const total = firebaseData.orders.length;
        const pending = firebaseData.orders.filter(o => o.status === 'pending').length;
        const completed = firebaseData.orders.filter(o => o.status === 'completed').length;
        const cancelled = firebaseData.orders.filter(o => o.status === 'cancelled').length;
        const revenue = firebaseData.orders.filter(o => o.status === 'completed').reduce((sum, o) => sum + o.totalAmount, 0);
        return { total, pending, completed, cancelled, revenue };
      }, [firebaseData.orders]);

      const updateYearlyTarget = async () => {
        const target = prompt('è¯·è¾“å…¥å¹´åº¦è¥ä¸šé¢ç›®æ ‡ï¼ˆå…ƒï¼‰ï¼š', firebaseData.settings.yearlyTarget || 0);
        if (target !== null) {
          await firebaseData.saveSettings({ ...firebaseData.settings, yearlyTarget: parseFloat(target) || 0 });
        }
      };

      const createNewYear = async () => {
        const year = prompt('è¯·è¾“å…¥æ–°å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2025ï¼‰ï¼š');
        if (year && !isNaN(year) && year.length === 4) {
          const yearNum = parseInt(year);
          const newYearlyData = { ...firebaseData.yearlyData, [yearNum]: { settled: false } };
          await firebaseData.saveYearlyData(newYearlyData);
          firebaseData.setYearlyData(newYearlyData);
          firebaseData.setCurrentYear(yearNum);
          setShowYearSelector(false);
        } else {
          alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´ä»½');
        }
      };

      const getCalendarDays = () => {
        const year = calendarDate.getFullYear();
        const month = calendarDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();

        const days = [];
        for (let i = 0; i < startingDayOfWeek; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(i);
        return days;
      };

      const getOrdersForDate = (day) => {
        if (!day) return [];
        const dateStr = `${calendarDate.getFullYear()}-${String(calendarDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        return firebaseData.orders.filter(order => order.deliveryDate === dateStr);
      };

      const changeMonth = (delta) => {
        const newDate = new Date(calendarDate);
        newDate.setMonth(newDate.getMonth() + delta);
        setCalendarDate(newDate);
      };

      return (
        <div className="min-h-screen bg-gray-50 pb-20">
          {/* é¡¶éƒ¨æ  */}
          <div className="bg-gradient-to-r from-pink-500 to-pink-600 text-white p-4 sticky top-0 z-10 shadow-lg">
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-3">
                <span className="text-2xl">ğŸª</span>
                <div>
                  <h1 className="text-xl font-bold">é¥¼å¹²è®¢å•ç®¡ç†</h1>
                  <p className="text-xs opacity-90">{user.email}</p>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setShowYearSelector(!showYearSelector)}
                  className="bg-white bg-opacity-20 px-3 py-2 rounded-lg text-sm font-medium"
                >
                  {firebaseData.currentYear}å¹´
                </button>
                <button
                  onClick={signOut}
                  className="bg-white bg-opacity-20 p-2 rounded-lg"
                  title="ç™»å‡º"
                >
                  <LogOut size={20} />
                </button>
              </div>
            </div>
          </div>

          {/* å¹´ä»½é€‰æ‹©å™¨ */}
          {showYearSelector && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg max-w-sm w-full p-4">
                <h3 className="text-lg font-bold mb-4">é€‰æ‹©å¹´ä»½</h3>
                <div className="space-y-2 max-h-60 overflow-y-auto mb-4">
                  {Object.keys(firebaseData.yearlyData).sort((a, b) => b - a).map(year => (
                    <button
                      key={year}
                      onClick={() => {
                        firebaseData.setCurrentYear(parseInt(year));
                        setShowYearSelector(false);
                      }}
                      className={`w-full p-3 rounded-lg text-left font-medium ${
                        parseInt(year) === firebaseData.currentYear
                          ? 'bg-pink-500 text-white'
                          : 'bg-gray-100 hover:bg-gray-200'
                      }`}
                    >
                      {year}å¹´
                    </button>
                  ))}
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => setShowYearSelector(false)}
                    className="flex-1 py-2 bg-gray-200 rounded-lg font-medium"
                  >
                    å–æ¶ˆ
                  </button>
                  <button
                    onClick={createNewYear}
                    className="flex-1 py-2 bg-pink-500 text-white rounded-lg font-medium"
                  >
                    æ–°å»ºå¹´ä»½
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* ä¸»è¦å†…å®¹ */}
          <div className="p-4">
            {activeTab === 'orders' && (
              <div>
                <div className="mb-4 flex gap-2">
                  <div className="flex-1 relative">
                    <Search className="absolute left-3 top-3 text-gray-400" size={20} />
                    <input
                      type="text"
                      placeholder="æœç´¢è®¢å•..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                    />
                  </div>
                  <button
                    onClick={() => setShowFilterPanel(!showFilterPanel)}
                    className="p-2 border border-gray-300 rounded-lg bg-white"
                  >
                    <Filter size={20} />
                  </button>
                </div>

                {showFilterPanel && (
                  <div className="mb-4 p-4 bg-white rounded-lg shadow space-y-3">
                    <div>
                      <label className="block text-sm font-medium mb-2">è®¢å•çŠ¶æ€</label>
                      <select
                        value={filterStatus}
                        onChange={(e) => setFilterStatus(e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        <option value="all">å…¨éƒ¨</option>
                        <option value="pending">å¾…å¤„ç†</option>
                        <option value="processing">åˆ¶ä½œä¸­</option>
                        <option value="completed">å·²å®Œæˆ</option>
                        <option value="cancelled">å·²å–æ¶ˆ</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-2">äº¤ä»˜æ—¶é—´</label>
                      <select
                        value={filterDateType}
                        onChange={(e) => setFilterDateType(e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        <option value="all">å…¨éƒ¨</option>
                        <option value="past">å·²è¿‡æœŸ</option>
                        <option value="upcoming">å³å°†åˆ°æ¥</option>
                      </select>
                    </div>
                    <button
                      onClick={() => {
                        setFilterStatus('all');
                        setFilterDateType('all');
                        setFilterDateRange({ start: '', end: '' });
                      }}
                      className="w-full py-2 bg-gray-200 rounded-lg text-sm font-medium"
                    >
                      æ¸…é™¤è¿‡æ»¤
                    </button>
                  </div>
                )}

                <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-white p-4 rounded-lg shadow">
                    <div className="text-gray-600 text-sm mb-1">æ€»è®¢å•</div>
                    <div className="text-2xl font-bold text-pink-600">{statistics.total}</div>
                  </div>
                  <div className="bg-white p-4 rounded-lg shadow">
                    <div className="text-gray-600 text-sm mb-1">å¾…å¤„ç†</div>
                    <div className="text-2xl font-bold text-orange-600">{statistics.pending}</div>
                  </div>
                  <div className="bg-white p-4 rounded-lg shadow">
                    <div className="text-gray-600 text-sm mb-1">å·²å®Œæˆ</div>
                    <div className="text-2xl font-bold text-green-600">{statistics.completed}</div>
                  </div>
                  <div className="bg-white p-4 rounded-lg shadow">
                    <div className="text-gray-600 text-sm mb-1">è¥ä¸šé¢</div>
                    <div className="text-2xl font-bold text-blue-600">Â¥{statistics.revenue.toFixed(2)}</div>
                    {firebaseData.settings.yearlyTarget > 0 && (
                      <div className="text-xs text-gray-500 mt-1">
                        ç›®æ ‡: Â¥{firebaseData.settings.yearlyTarget} ({((statistics.revenue / firebaseData.settings.yearlyTarget) * 100).toFixed(1)}%)
                      </div>
                    )}
                  </div>
                </div>

                <div className="space-y-3">
                  {filteredOrders.length === 0 ? (
                    <div className="text-center py-12 text-gray-500">
                      <Package size={48} className="mx-auto mb-2 opacity-50" />
                      <p>è¿˜æ²¡æœ‰è®¢å•</p>
                    </div>
                  ) : (
                    filteredOrders.map(order => (
                      <div key={order.id} className="bg-white p-4 rounded-lg shadow">
                        <div className="flex justify-between items-start mb-2">
                          <div className="flex-1">
                            <div className="font-bold text-lg">{order.customerName}</div>
                            <div className="text-sm text-gray-600">{order.customerPhone}</div>
                          </div>
                          <div className="flex gap-2">
                            <button onClick={() => editOrder(order)} className="text-blue-600 p-1">
                              <Edit2 size={18} />
                            </button>
                            <button onClick={() => removeOrder(order.id)} className="text-red-600 p-1">
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </div>
                        <div className="space-y-1 text-sm mb-2">
                          {order.products.map((product, idx) => (
                            <div key={idx} className="text-gray-700">
                              {product.name} ({product.size}) x {product.quantity} - Â¥{(product.price * product.quantity).toFixed(2)}
                            </div>
                          ))}
                        </div>
                        <div className="flex justify-between items-center pt-2 border-t">
                          <div className="text-sm text-gray-600">
                            äº¤ä»˜: {order.deliveryDate || 'æœªè®¾ç½®'}
                          </div>
                          <div className="flex items-center gap-2">
                            <span className={`text-xs px-2 py-1 rounded ${
                              order.status === 'pending' ? 'bg-orange-100 text-orange-700' :
                              order.status === 'processing' ? 'bg-blue-100 text-blue-700' :
                              order.status === 'completed' ? 'bg-green-100 text-green-700' :
                              'bg-gray-100 text-gray-700'
                            }`}>
                              {order.status === 'pending' ? 'å¾…å¤„ç†' :
                               order.status === 'processing' ? 'åˆ¶ä½œä¸­' :
                               order.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ'}
                            </span>
                            <span className="font-bold text-pink-600">Â¥{order.totalAmount.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}

            {activeTab === 'calendar' && (
              <div className="bg-white rounded-lg shadow p-4">
                <div className="flex justify-between items-center mb-4">
                  <button onClick={() => changeMonth(-1)} className="p-2 hover:bg-gray-100 rounded">
                    <ChevronLeft size={24} />
                  </button>
                  <h2 className="text-xl font-bold">
                    {calendarDate.getFullYear()}å¹´ {calendarDate.getMonth() + 1}æœˆ
                  </h2>
                  <button onClick={() => changeMonth(1)} className="p-2 hover:bg-gray-100 rounded">
                    <ChevronRight size={24} />
                  </button>
                </div>
                <div className="calendar-grid mb-2">
                  {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(day => (
                    <div key={day} className="text-center text-sm font-medium text-gray-600 py-2">
                      {day}
                    </div>
                  ))}
                </div>
                <div className="calendar-grid">
                  {getCalendarDays().map((day, index) => {
                    const orders = day ? getOrdersForDate(day) : [];
                    const hasOrders = orders.length > 0;
                    
                    return (
                      <div
                        key={index}
                        className={`calendar-day border rounded p-1 ${
                          day ? 'bg-white hover:bg-gray-50' : 'bg-gray-100'
                        } ${hasOrders ? 'border-pink-300' : 'border-gray-200'}`}
                      >
                        {day && (
                          <>
                            <div className="text-sm font-medium mb-1">{day}</div>
                            {hasOrders && (
                              <div className="space-y-1">
                                {orders.slice(0, 2).map((order, idx) => (
                                  <div
                                    key={idx}
                                    className="text-xs bg-pink-100 text-pink-700 px-1 py-0.5 rounded truncate"
                                  >
                                    {order.customerName}
                                  </div>
                                ))}
                                {orders.length > 2 && (
                                  <div className="text-xs text-gray-600 px-1">
                                    +{orders.length - 2} æ›´å¤š
                                  </div>
                                )}
                              </div>
                            )}
                          </>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {activeTab === 'customers' && (
              <div>
                <div className="mb-4">
                  <input
                    type="text"
                    placeholder="æœç´¢å®¢æˆ·..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                  />
                </div>
                <div className="space-y-3">
                  {firebaseData.customers
                    .filter(customer => 
                      !searchTerm || 
                      customer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                      customer.phone.includes(searchTerm)
                    )
                    .map(customer => (
                      <div key={customer.id} className="bg-white p-4 rounded-lg shadow">
                        <div className="flex justify-between items-start mb-2">
                          <div className="flex-1">
                            <div className="font-bold text-lg">{customer.name}</div>
                            <div className="text-sm text-gray-600">{customer.phone}</div>
                            {customer.address && (
                              <div className="text-sm text-gray-600 mt-1">{customer.address}</div>
                            )}
                          </div>
                          <div className="flex gap-2">
                            <button onClick={() => editCustomer(customer)} className="text-blue-600 p-1">
                              <Edit2 size={18} />
                            </button>
                            <button onClick={() => removeCustomer(customer.id)} className="text-red-600 p-1">
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </div>
                        {customer.notes && (
                          <div className="text-sm text-gray-600 mt-2 pt-2 border-t">
                            å¤‡æ³¨: {customer.notes}
                          </div>
                        )}
                      </div>
                    ))}
                </div>
                {firebaseData.customers.length === 0 && (
                  <div className="text-center py-12 text-gray-500">
                    <Users size={48} className="mx-auto mb-2 opacity-50" />
                    <p>è¿˜æ²¡æœ‰å®¢æˆ·</p>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'products' && (
              <div className="space-y-3">
                {firebaseData.products.map(product => (
                  <div key={product.id} className="bg-white p-4 rounded-lg shadow">
                    <div className="flex justify-between items-start mb-2">
                      <div className="flex-1">
                        <div className="font-bold text-lg">{product.name}</div>
                        {product.description && (
                          <div className="text-sm text-gray-600 mt-1">{product.description}</div>
                        )}
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => editProduct(product)} className="text-blue-600 p-1">
                          <Edit2 size={18} />
                        </button>
                        <button onClick={() => removeProduct(product.id)} className="text-red-600 p-1">
                          <Trash2 size={18} />
                        </button>
                      </div>
                    </div>
                    <div className="mt-2 space-y-1">
                      {product.sizes.map((size, idx) => (
                        <div key={idx} className="flex justify-between text-sm">
                          <span>{size.name}</span>
                          <span className="font-medium text-pink-600">Â¥{size.price}</span>
                        </div>
                      ))}
                    </div>
                    {product.unit && (
                      <div className="text-xs text-gray-500 mt-2">å•ä½: {product.unit}</div>
                    )}
                  </div>
                ))}
                {firebaseData.products.length === 0 && (
                  <div className="text-center py-12 text-gray-500">
                    <Package size={48} className="mx-auto mb-2 opacity-50" />
                    <p>è¿˜æ²¡æœ‰äº§å“</p>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'settings' && (
              <div className="space-y-4">
                <div className="bg-white p-4 rounded-lg shadow">
                  <h3 className="font-bold mb-3">å¹´åº¦è®¾ç½®</h3>
                  <button
                    onClick={updateYearlyTarget}
                    className="w-full py-3 bg-pink-500 text-white rounded-lg font-medium"
                  >
                    è®¾ç½®å¹´åº¦è¥ä¸šé¢ç›®æ ‡
                  </button>
                  {firebaseData.settings.yearlyTarget > 0 && (
                    <div className="mt-2 text-sm text-gray-600">
                      å½“å‰ç›®æ ‡: Â¥{firebaseData.settings.yearlyTarget}
                    </div>
                  )}
                </div>
                <div className="bg-white p-4 rounded-lg shadow">
                  <h3 className="font-bold mb-3">è´¦å·ä¿¡æ¯</h3>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-600">é‚®ç®±:</span>
                      <span className="font-medium">{user.email}</span>
                    </div>
                  </div>
                </div>
                <div className="bg-white p-4 rounded-lg shadow">
                  <h3 className="font-bold mb-3">æ•°æ®åŒæ­¥</h3>
                  <div className="text-sm text-gray-600 mb-3">
                    ä½ çš„æ•°æ®å·²è‡ªåŠ¨ä¿å­˜åˆ°äº‘ç«¯ï¼Œæ”¯æŒå¤šè®¾å¤‡åŒæ­¥å’Œç¦»çº¿ä½¿ç”¨ã€‚
                  </div>
                  <div className="flex items-center gap-2 text-green-600 text-sm">
                    <Check size={16} />
                    <span>äº‘ç«¯åŒæ­¥å·²å¯ç”¨</span>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* åº•éƒ¨å¯¼èˆª */}
          <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg">
            <div className="flex justify-around items-center py-2">
              <button
                onClick={() => setActiveTab('orders')}
                className={`flex flex-col items-center py-2 px-4 ${
                  activeTab === 'orders' ? 'text-pink-600' : 'text-gray-600'
                }`}
              >
                <Package size={24} />
                <span className="text-xs mt-1">è®¢å•</span>
              </button>
              <button
                onClick={() => setActiveTab('calendar')}
                className={`flex flex-col items-center py-2 px-4 ${
                  activeTab === 'calendar' ? 'text-pink-600' : 'text-gray-600'
                }`}
              >
                <Calendar size={24} />
                <span className="text-xs mt-1">æ—¥å†</span>
              </button>
              <button
                onClick={() => setActiveTab('customers')}
                className={`flex flex-col items-center py-2 px-4 ${
                  activeTab === 'customers' ? 'text-pink-600' : 'text-gray-600'
                }`}
              >
                <Users size={24} />
                <span className="text-xs mt-1">å®¢æˆ·</span>
              </button>
              <button
                onClick={() => setActiveTab('products')}
                className={`flex flex-col items-center py-2 px-4 ${
                  activeTab === 'products' ? 'text-pink-600' : 'text-gray-600'
                }`}
              >
                <Package size={24} />
                <span className="text-xs mt-1">äº§å“</span>
              </button>
              <button
                onClick={() => setActiveTab('settings')}
                className={`flex flex-col items-center py-2 px-4 ${
                  activeTab === 'settings' ? 'text-pink-600' : 'text-gray-600'
                }`}
              >
                <Settings size={24} />
                <span className="text-xs mt-1">è®¾ç½®</span>
              </button>
            </div>
          </div>

          {/* æµ®åŠ¨æ·»åŠ æŒ‰é’® */}
          {(activeTab === 'orders' || activeTab === 'customers' || activeTab === 'products') && (
            <button
              onClick={() => {
                if (activeTab === 'orders') addOrder();
                else if (activeTab === 'customers') addCustomer();
                else if (activeTab === 'products') addProduct();
              }}
              className="fixed right-4 bottom-20 bg-pink-500 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-pink-600"
            >
              <Plus size={28} />
            </button>
          )}

          {/* è®¢å•è¡¨å• */}
          {showOrderForm && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50">
              <div className="bg-white w-full sm:max-w-2xl sm:rounded-lg rounded-t-lg max-h-[90vh] overflow-y-auto">
                <div className="sticky top-0 bg-white border-b px-4 py-3 flex justify-between items-center">
                  <h2 className="text-xl font-bold">{editingOrder ? 'ç¼–è¾‘è®¢å•' : 'æ–°å¢è®¢å•'}</h2>
                  <button onClick={resetOrderForm} className="text-gray-500">
                    <X size={24} />
                  </button>
                </div>
                <div className="p-4 space-y-4">
                  <div className="bg-gray-50 p-3 rounded-lg">
                    <div className="font-medium mb-2 flex justify-between items-center">
                      <span>å®¢æˆ·ä¿¡æ¯</span>
                      {firebaseData.customers.length > 0 && (
                        <select
                          onChange={(e) => {
                            const customer = firebaseData.customers.find(c => c.id === e.target.value);
                            if (customer) selectCustomerForOrder(customer);
                          }}
                          className="text-sm px-2 py-1 border rounded"
                        >
                          <option value="">é€‰æ‹©å·²æœ‰å®¢æˆ·</option>
                          {firebaseData.customers.map(c => (
                            <option key={c.id} value={c.id}>{c.name} - {c.phone}</option>
                          ))}
                        </select>
                      )}
                    </div>
                    <div className="space-y-2">
                      <input
                        type="text"
                        placeholder="å®¢æˆ·å§“å *"
                        value={orderForm.customerName}
                        onChange={(e) => setOrderForm({ ...orderForm, customerName: e.target.value })}
                        className="w-full px-3 py-2 border rounded"
                      />
                      <input
                        type="tel"
                        placeholder="å®¢æˆ·ç”µè¯ *"
                        value={orderForm.customerPhone}
                        onChange={(e) => setOrderForm({ ...orderForm, customerPhone: e.target.value })}
                        className="w-full px-3 py-2 border rounded"
                      />
                      <input
                        type="text"
                        placeholder="äº¤ä»˜åœ°å€"
                        value={orderForm.deliveryAddress}
                        onChange={(e) => setOrderForm({ ...orderForm, deliveryAddress: e.target.value })}
                        className="w-full px-3 py-2 border rounded"
                      />
                    </div>
                  </div>

                  <div>
                    <div className="font-medium mb-2">äº§å“æ˜ç»†</div>
                    {orderForm.products.map((product, index) => (
                      <div key={index} className="bg-gray-50 p-3 rounded-lg mb-2">
                        <div className="flex justify-between items-start mb-2">
                          <span className="text-sm font-medium">äº§å“ {index + 1}</span>
                          {orderForm.products.length > 1 && (
                            <button
                              onClick={() => removeOrderProduct(index)}
                              className="text-red-600 text-sm"
                            >
                              <Trash2 size={16} />
                            </button>
                          )}
                        </div>
                        {firebaseData.products.length > 0 && (
                          <select
                            onChange={(e) => {
                              const p = firebaseData.products.find(p => p.id === e.target.value);
                              if (p) selectProductForOrder(p, index);
                            }}
                            className="w-full px-3 py-2 border rounded mb-2 text-sm"
                          >
                            <option value="">é€‰æ‹©äº§å“</option>
                            {firebaseData.products.map(p => (
                              <option key={p.id} value={p.id}>{p.name}</option>
                            ))}
                          </select>
                        )}
                        <div className="grid grid-cols-2 gap-2 mb-2">
                          <input
                            type="text"
                            placeholder="äº§å“åç§°"
                            value={product.name}
                            onChange={(e) => updateOrderProduct(index, 'name', e.target.value)}
                            className="px-3 py-2 border rounded text-sm"
                          />
                          <select
                            value={product.size}
                            onChange={(e) => {
                              updateOrderProduct(index, 'size', e.target.value);
                              updateProductPrice(index, e.target.value);
                            }}
                            className="px-3 py-2 border rounded text-sm"
                          >
                            <option value="">é€‰æ‹©å¤§å°</option>
                            {product.name && firebaseData.products.find(p => p.name === product.name)?.sizes.map((size, idx) => (
                              <option key={idx} value={size.name}>{size.name}</option>
                            ))}
                          </select>
                        </div>
                        <div className="grid grid-cols-3 gap-2">
                          <input
                            type="number"
                            placeholder="æ•°é‡"
                            value={product.quantity}
                            onChange={(e) => updateOrderProduct(index, 'quantity', parseInt(e.target.value) || 1)}
                            className="px-3 py-2 border rounded text-sm"
                            min="1"
                          />
                          <input
                            type="number"
                            placeholder="å•ä»·"
                            value={product.price}
                            onChange={(e) => updateOrderProduct(index, 'price', parseFloat(e.target.value) || 0)}
                            step="0.01"
                            className="px-3 py-2 border rounded text-sm"
                          />
                          <div className="px-3 py-2 bg-white border rounded text-sm flex items-center justify-end font-medium">
                            Â¥{(product.price * product.quantity).toFixed(2)}
                          </div>
                        </div>
                      </div>
                    ))}
                    <button
                      onClick={addOrderProduct}
                      className="text-pink-600 text-sm font-medium flex items-center gap-1 mt-2"
                    >
                      <Plus size={16} />
                      æ·»åŠ äº§å“
                    </button>
                  </div>

                  <div className="bg-pink-50 p-3 rounded-lg flex justify-between items-center">
                    <span className="font-bold">è®¢å•æ€»é¢</span>
                    <span className="text-2xl font-bold text-pink-600">Â¥{orderForm.totalAmount.toFixed(2)}</span>
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-sm font-medium mb-2">ä¸‹å•æ—¥æœŸ</label>
                      <input
                        type="date"
                        value={orderForm.orderDate}
                        onChange={(e) => setOrderForm({ ...orderForm, orderDate: e.target.value })}
                        className="w-full px-3 py-2 border rounded"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-2">äº¤ä»˜æ—¥æœŸ</label>
                      <input
                        type="date"
                        value={orderForm.deliveryDate}
                        onChange={(e) => setOrderForm({ ...orderForm, deliveryDate: e.target.value })}
                        className="w-full px-3 py-2 border rounded"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-2">è®¢å•çŠ¶æ€</label>
                    <select
                      value={orderForm.status}
                      onChange={(e) => setOrderForm({ ...orderForm, status: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                    >
                      <option value="pending">å¾…å¤„ç†</option>
                      <option value="processing">åˆ¶ä½œä¸­</option>
                      <option value="completed">å·²å®Œæˆ</option>
                      <option value="cancelled">å·²å–æ¶ˆ</option>
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-2">å¤‡æ³¨</label>
                    <textarea
                      value={orderForm.notes}
                      onChange={(e) => setOrderForm({ ...orderForm, notes: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                      rows="3"
                    />
                  </div>

                  <div className="flex gap-2 pt-4">
                    <button
                      onClick={resetOrderForm}
                      className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium"
                    >
                      å–æ¶ˆ
                    </button>
                    <button
                      onClick={saveOrder}
                      className="flex-1 py-3 bg-pink-500 text-white rounded-lg font-medium"
                    >
                      ä¿å­˜è®¢å•
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* å®¢æˆ·è¡¨å• */}
          {showCustomerForm && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50">
              <div className="bg-white w-full sm:max-w-lg sm:rounded-lg rounded-t-lg max-h-[90vh] overflow-y-auto">
                <div className="sticky top-0 bg-white border-b px-4 py-3 flex justify-between items-center">
                  <h2 className="text-xl font-bold">{editingCustomer ? 'ç¼–è¾‘å®¢æˆ·' : 'æ–°å¢å®¢æˆ·'}</h2>
                  <button onClick={resetCustomerForm} className="text-gray-500">
                    <X size={24} />
                  </button>
                </div>
                <div className="p-4 space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-2">å®¢æˆ·å§“å *</label>
                    <input
                      type="text"
                      value={customerForm.name}
                      onChange={(e) => setCustomerForm({ ...customerForm, name: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">ç”µè¯ *</label>
                    <input
                      type="tel"
                      value={customerForm.phone}
                      onChange={(e) => setCustomerForm({ ...customerForm, phone: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">åœ°å€</label>
                    <input
                      type="text"
                      value={customerForm.address}
                      onChange={(e) => setCustomerForm({ ...customerForm, address: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">å¤‡æ³¨</label>
                    <textarea
                      value={customerForm.notes}
                      onChange={(e) => setCustomerForm({ ...customerForm, notes: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                      rows="3"
                    />
                  </div>
                  <div className="flex gap-2 pt-4">
                    <button
                      onClick={resetCustomerForm}
                      className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium"
                    >
                      å–æ¶ˆ
                    </button>
                    <button
                      onClick={saveCustomer}
                      className="flex-1 py-3 bg-pink-500 text-white rounded-lg font-medium"
                    >
                      ä¿å­˜å®¢æˆ·
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* äº§å“è¡¨å• */}
          {showProductForm && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50">
              <div className="bg-white w-full sm:max-w-lg sm:rounded-lg rounded-t-lg max-h-[90vh] overflow-y-auto">
                <div className="sticky top-0 bg-white border-b px-4 py-3 flex justify-between items-center">
                  <h2 className="text-xl font-bold">{editingProduct ? 'ç¼–è¾‘äº§å“' : 'æ–°å¢äº§å“'}</h2>
                  <button onClick={resetProductForm} className="text-gray-500">
                    <X size={24} />
                  </button>
                </div>
                <div className="p-4 space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-2">äº§å“åç§° *</label>
                    <input
                      type="text"
                      value={productForm.name}
                      onChange={(e) => setProductForm({ ...productForm, name: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                      placeholder="ä¾‹å¦‚ï¼šå·§å…‹åŠ›æ›²å¥‡"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">å¤§å°å’Œä»·æ ¼ *</label>
                    {productForm.sizes.map((size, index) => (
                      <div key={index} className="flex gap-2 mb-2">
                        <input
                          type="text"
                          value={size.name}
                          onChange={(e) => updateProductSize(index, 'name', e.target.value)}
                          placeholder="å¤§å°åç§°"
                          className="flex-1 px-3 py-2 border rounded"
                        />
                        <input
                          type="number"
                          value={size.price}
                          onChange={(e) => updateProductSize(index, 'price', parseFloat(e.target.value) || 0)}
                          step="0.01"
                          placeholder="ä»·æ ¼"
                          className="w-24 px-3 py-2 border rounded"
                        />
                        {productForm.sizes.length > 1 && (
                          <button
                            onClick={() => removeProductSize(index)}
                            className="p-2 text-red-600"
                          >
                            <Trash2 size={20} />
                          </button>
                        )}
                      </div>
                    ))}
                    <button
                      onClick={addProductSize}
                      className="text-pink-600 text-sm font-medium flex items-center gap-1"
                    >
                      <Plus size={16} />
                      æ·»åŠ å¤§å°é€‰é¡¹
                    </button>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">å•ä½</label>
                    <input
                      type="text"
                      value={productForm.unit}
                      onChange={(e) => setProductForm({ ...productForm, unit: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                      placeholder="ç›’/åŒ…/ä¸ª"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">æè¿°</label>
                    <textarea
                      value={productForm.description}
                      onChange={(e) => setProductForm({ ...productForm, description: e.target.value })}
                      className="w-full px-3 py-2 border rounded"
                      rows="3"
                      placeholder="äº§å“æè¿°æˆ–ç‰¹è‰²"
                    />
                  </div>
                  <div className="flex gap-2 pt-4">
                    <button
                      onClick={resetProductForm}
                      className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium"
                    >
                      å–æ¶ˆ
                    </button>
                    <button
                      onClick={saveProduct}
                      className="flex-1 py-3 bg-pink-500 text-white rounded-lg font-medium"
                    >
                      ä¿å­˜äº§å“
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ'))
        .catch((e) => console.log('Service Worker æ³¨å†Œå¤±è´¥:', e));
    }
  </script>
</body>
</html>
